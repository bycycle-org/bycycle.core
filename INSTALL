byCycle Core Installation
+++++++++++++++++++++++++

byCycle is deployed to Ubuntu 14.04. The following section lists packages that
aren't part of the base server install, their versions, and their Ubuntu
package names.

Packages
========

Mercurial
---------
mercurial

PostgreSQL 9.3
--------------
postgresql libpq-dev

GEOS 3.4.2
----------
libgeos-dev

Proj 4.8
--------
proj-bin proj-data (?)

PostGIS 2.1
-----------
postgis postgresql-9.3-postgis-2.1

Python 3.4
==========

Python 3.4 is included by default in the Ubuntu 14.04 distribution.

PostgreSQL Configuration
========================

# Create and configure the byCycle database. The following commands should
# be run as the postgres user. $USER is whatever OS user you'll be using to
# run the integrate script and tests (tip: run these commands under your
# user using `sudo -u postgres`).

DB_NAME=bycycle  # Required to be bycycle for now
createuser --no-superuser --no-createrole --no-createdb --pwprompt $USER
createdb --owner $USER $DB_NAME
createlang plpgsql $DB_NAME

# Install PostGIS stuff into the bycycle database
cd /usr/share/postgresql/9.3/contrib/postgis-2.1
psql -d $DB_NAME -f postgis.sql
psql -d $DB_NAME -f spatial_ref_sys.sql

# Fix ownership
psql -d $DB_NAME -c "ALTER SCHEMA public OWNER TO $USER"
psql -d $DB_NAME -c "ALTER TABLE geometry_columns OWNER TO $USER"
psql -d $DB_NAME -c "ALTER TABLE spatial_ref_sys OWNER TO $USER"

Installation of byCycle Core
============================

Set Up a Project Environment
----------------------------

cd $PROJECT_DIRECTORY
mkdir src

# Clone or fork the code from Bitbucket:
hg clone https://bitbucket.org/bycycle/bycycle.core src

# You'll need to create the file src/bycycle.core/bycycle/core/model/.pw
# containing a single line with your PostgreSQL password. See Configuration
# section below for more info on setting up Postgres.

virtualenv $ENV_NAME
source $ENV_NAME/bin/activate

Install bycycle.core into the virtualenv
----------------------------------------

cd src/bycycle.core
python setup.py develop

Insert Some Data
----------------

# Run bycycle/core/scripts/integrate.py for each region. The following is an
# example for Portland, OR. Shapefiles are assumed to be in
# ~/byCycleData/$REGION/$DATA_SOURCE.

bycycle/core/scripts/integrate.py -r portlandor -d pirate -l str06oct

Test
----

nosetests
