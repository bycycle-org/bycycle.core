byCycle Core Installation
+++++++++++++++++++++++++

This document provides details on how to install byCycle Core, especially
for purposes of development.

Dev Stack
=========

byCycle is developed mainly on Ubuntu 12.10. The following sections list the
required packages, their versions, and their Ubuntu package names.

Mercurial 2.2
-------------
mercurial

PostgreSQL 9.1
--------------
postgresql libpq-dev

GEOS 3
------
libgeos-3.3.3 libgeos-dev

Proj 4.7
--------
proj-bin proj-data (?)

PostGIS 1.5
-----------
postgis postgresql-9.1-postgis

Python 3.3
----------
python3

PostgreSQL Configuration
========================

# Create and configure the byCycle database. The following commands should
# be run as the postgres user. $USER is whatever OS user you'll be using to
# run the integrate script and tests (tip: run these commands under your
# user using `sudo -u postgres`).

DB_NAME=bycycle  # Required to be bycycle for now
createuser --no-superuser --no-createrole --no-createdb --pwprompt $USER
createdb --owner $USER $DB_NAME
createlang plpgsql $DB_NAME

# Install PostGIS stuff into the bycycle database
cd /usr/share/postgresql/9.1/contrib/postgis-1.5
psql -d $DB_NAME -f postgis.sql
psql -d $DB_NAME -f spatial_ref_sys.sql

# Fix ownership
psql -d $DB_NAME -c "ALTER SCHEMA public OWNER TO $USER"
psql -d $DB_NAME -c "ALTER TABLE geometry_columns OWNER TO $USER"
psql -d $DB_NAME -c "ALTER TABLE spatial_ref_sys OWNER TO $USER"

Installation of byCycle Core
============================

Set Up a Project Environment
----------------------------

cd $PROJECT_DIRECTORY
mkdir src

# Clone or fork the code from Bitbucket:
hg clone https://bitbucket.org/bycycle/bycycle.core src

# You'll need to create the file src/bycycle.core/bycycle/core/model/.pw
# containing a single line with your PostgreSQL password. See Configuration
# section below for more info on setting up Postgres.

virtualenv $ENV_NAME
source $ENV_NAME/bin/activate

Install bycycle.core into the virtualenv
----------------------------------------

cd src/bycycle.core
python setup.py develop

Insert Some Data
----------------

# Run bycycle/core/scripts/integrate.py for each region. The following is an
# example for Portland, OR. Shapefiles are assumed to be in
# ~/byCycleData/$REGION/$DATA_SOURCE.

bycycle/core/scripts/integrate.py -r portlandor -d pirate -l str06oct

Test
----

nosetests
